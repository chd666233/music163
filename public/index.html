<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
  <style>
    .main{
      position: relative;
    }
    .cover_iframe{
      background:transparent;
      position: absolute;
      left:0;top:0;right:0;bottom:0;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <header id="header">
    <nav class="navbar" id="navbar">
      <div class="nav-top">
        <div>
          <h1><a href="#">网页云音乐</a></h1>
          <ul>
            <li class="active"><a href="#"><em>发现音乐</em><i></i></a></li>
            <li><a href="#"><em>我的音乐</em><i></i></a></li>
            <li><a href="#"><em>朋友</em><i></i></a></li>
            <li><a href="#"><em>商城</em><i></i></a></li>
            <li><a href="nmusician.html"><em>音乐人</em><i></i></a></li>
            <li><a href="#"><em>下载客户端</em><i></i><span class="hot"></span></a></li>
          </ul>
          <div class="login">
            <a href="#">登陆</a>
            <div class="drawdown">
              <i></i>
              <ul>
                <li><a href="#"><i class="icn-mb"></i><em>手机号登陆</em></a></li>
                <li><a href="#"><i class="icn-wx"></i><em>微信登陆</em></a></li>
                <li><a href="#"><i class="icn-qq"></i><em>QQ登陆</em></a></li>
                <li><a href="#"><i class="icn-sn"></i><em>新浪微博登陆</em></a></li>
                <li><a href="#"><i class="icn-wy"></i><em>网易邮箱账号登陆</em></a></li>
              </ul>
            </div>
          </div>
          <a class="creator-center" href="#">创作者中心</a>
          <div class="search-box">
            <label for="">音乐/视频/用户/电台</label>
            <input type="text">
          </div>
        </div>
      </div>
      <div class="nav-bottom">
        <ul class="nav-ul">
          <li class="active"><a href="#">推荐</a></li>
          <li><a href="#">排行榜</a></li>
          <li><a href="#">歌单</a></li>
          <li><a href="#">主播电台</a></li>
          <li><a href="#">歌手</a></li>
          <li><a href="#">新碟上架</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <section id="main" class="main">
    <iframe name="contentFrame" src="main.html" frameborder="0" scrolling="no"></iframe>
    <!-- iframe无法触发onmousewheel事件，所以添加一层盖住iframe以次触发document.conmousewheel事件 -->
    <!-- <div class="cover_iframe" id="cover_iframe"></div> -->
  </section>
 
  <footer>
    <div>
      <div class="f-lf">
        <ul>
          <li><a href="">关于网易</a></li>
          <li><a href="">客户服务</a></li>
          <li><a href="">服务条款</a></li>
          <li><a href="">网站导航</a></li>
          <li><a href="">意见反馈</a></li>
        </ul>
        <p>
          <span>网易公司版权所有©1997-2019</span>
          <span>杭州乐读科技有限公司运营：<a href="#">浙网文[2018]3506-263号</a></span>
        </p>
        <p>
          <span>违法和不良信息举报电话：0571-89853516</span> 
          <span>举报邮箱：<a href="#">ncm5990@163.com</a></span>
        </p>
      </div>
      <div class="f-rt">
        <ul>
          <li class="auth"><a href="#"></a><i></i></li>
          <li class="musician"><a href="#"></a><i></i></li>
          <li class="reward"><a href="#"></a><i></i></li>
          <li class="cash"><a href="#"></a><i></i></li>
        </ul>
      </div>
    </div>
  </footer>
  <script>
    "use strict";
  //  window.onload=function(){
  //   console.log(window.frames["contentFrame"].document.getElementById("ifr"))
  //   var ifr=window.frames["contentFrame"].document.getElementById("ifr");
  //   console.log(getComputedStyle(ifr).height)
  //   var ifrH=getComputedStyle(ifr).height;

    
  //   document.getElementsByName("contentFrame")[0].style.height=ifrH;
  //   main.style.height=ifrH;
  //  }
   window.onload=function(){
     /* *****************************设置iframe和main的高 */
    //获取iframe内的document
    var ifr_document=window.frames["contentFrame"].document;
    //获取iframe内的document内的body
    var ifr_body=ifr_document.getElementById("ifr");
    
    //设置高度
    var ifrH=getComputedStyle(ifr_body).height;
    document.getElementsByName("contentFrame")[0].style.height=ifrH;
    var main =document.getElementById("main");
    var cover_iframe = document.getElementById("cover_iframe");
    main.style.height=ifrH;

    /* *************************图片懒加载 */

    var isMacWebkit = (navigator.userAgent.indexOf("Macintosh")!==-1&&
                        navigator.userAgent.indexOf("WebKit") !== -1);
    var isFirefox=(navigator.userAgent.indexOf("Gecko")!==-1);


    var header=document.getElementById("header");
    var headerH=header.offsetHeight;
    var viewH=innerHeight;
    var scrollTop = 0;
    var prevTime=0;
    
    //0  4  8  16   20
    var floorContainer=ifr_document.getElementById("floor-container");
    var imgs=floorContainer.getElementsByTagName("img");
    console.log(imgs)
    console.log(imgs[8].offsetParent.offsetParent.offsetParent.offsetParent.offsetParent)


    document.onwheel=ifr_document.onwheel=fn_wheelHandler;//未来浏览器
    document.onwheel=ifr_document.onmousewheel=fn_wheelHandler;//大多数当前浏览器
    if(isFirefox){//仅火狐
      ifr_document.addEventListener('DOMMouseScroll',fn_wheelHandler,false);
      document.addEventListener('DOMMouseScroll',fn_wheelHandler,false);
    }

    loadImg();
    function fn_wheelHandler(event){
      //两次滚动价格超过500ms
      var currentTime = new Date().getTime();
      if(currentTime-prevTime<500) return;
      

      var e= event || window.event;//标准 || IE
      if(isFirefox && e.type!=="DOMMouseScroll"){
        ifr_document.removeEventListener('DOMMouseScroll',fn_wheelHandler,false);
        document.removeEventListener("DOMMouseScroll",fn_wheelHandler,false);
      }
        

      loadImg()

      prevTime=new Date().getTime();


      if(e.preventDefault) e.preventDefault();//阻止默认
      if(e.stopPropagation) e.stopPropagation();//阻止冒泡
      e.cancelBubble=true;//IE 阻止冒泡
      e.returnValue=false;//IE
      return false;
    }


    function loadImg(){
      scrollTop=document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
      for (var img of imgs){
        let top = img.offsetTop;
        let temp = img;
        while(img = img.offsetParent){//获得图片到文档顶部的距离
          top+=img.offsetTop;
        }
        img= temp;
        if(top+headerH<=scrollTop+viewH+50){
            img.src=img.getAttribute("data-src")
        }
      }
    }
   }
   
   
  </script>
</body>
</html>