<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
  <link rel="stylesheet" href="css/player.css">
  <!-- <style>
    .main{
      position: relative;
    }
    .cover_iframe{
      background:transparent;
      position: absolute;
      left:0;top:0;right:0;bottom:0;
      z-index: 9999;
    }
  </style> -->
</head>
<body>
  <header id="header">
    <nav class="navbar" id="navbar">
      <div class="nav-top">
        <div>
          <h1><a href="#">网页云音乐</a></h1>
          <ul>
            <li class="active"><a href="#"><em>发现音乐</em><i></i></a></li>
            <li><a href="#"><em>我的音乐</em><i></i></a></li>
            <li><a href="#"><em>朋友</em><i></i></a></li>
            <li><a href="#"><em>商城</em><i></i></a></li>
            <li><a href="nmusician.html"><em>音乐人</em><i></i></a></li>
            <li><a href="#"><em>下载客户端</em><i></i><span class="hot"></span></a></li>
          </ul>
          <div class="login">
            <a href="#">登陆</a>
            <div class="drawdown">
              <i></i>
              <ul>
                <li><a href="#"><i class="icn-mb"></i><em>手机号登陆</em></a></li>
                <li><a href="#"><i class="icn-wx"></i><em>微信登陆</em></a></li>
                <li><a href="#"><i class="icn-qq"></i><em>QQ登陆</em></a></li>
                <li><a href="#"><i class="icn-sn"></i><em>新浪微博登陆</em></a></li>
                <li><a href="#"><i class="icn-wy"></i><em>网易邮箱账号登陆</em></a></li>
              </ul>
            </div>
          </div>
          <a class="creator-center" href="#">创作者中心</a>
          <div class="search-box">
            <label for="">音乐/视频/用户/电台</label>
            <input type="text">
          </div>
        </div>
      </div>
      <div class="nav-bottom">
        <ul class="nav-ul">
          <li class="active"><a href="#">推荐</a></li>
          <li><a href="#">排行榜</a></li>
          <li><a href="#">歌单</a></li>
          <li><a href="#">主播电台</a></li>
          <li><a href="#">歌手</a></li>
          <li><a href="#">新碟上架</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <section id="main" class="main">
    <iframe name="contentFrame" src="main.html" frameborder="0" scrolling="no"></iframe>
    <!-- iframe无法触发onmousewheel事件，所以添加一层盖住iframe以次触发document.conmousewheel事件
    问题：由于被覆盖了一层，无法点击后面一层的事件，轮播图，指示器无法点击 -->
    <!-- <div class="cover_iframe" id="cover_iframe"></div> -->
  </section>
  
  <div class="player" id="player">
    <div class="bg"></div>
    <div class="container">
      <div class="control1">
        <a href="javascript:;" class="prev" title="上一首"></a>
        <a href="javascript:;" class="play" title="播放/暂停"></a>
        <a href="javascript:;" class="next" title="下一首"></a>
      </div>
      <div class="control2">
        <div class="cover" id="sm_cover">
            <img src="img/default_album.jpg" alt="">
            <a href="#" ></a>
        </div>
        
        <div class="info">
          <div class="song_info" id="song_info">
            <a href="#" class="song"><!-- Rolling star --></a>
            <!-- <a href="#" class="mv"></a> -->
            <a href="#" class="artist" id="artist"><!-- YUI --></a>
            <!-- <a href="#" class="src" title="来自榜单"></a> -->
          </div>
          <div class="play_box">
            <div class="playbar">
              <div class="rdy"></div>
              <div class="cur">
                <span class="circle">
                  <img class="loading" src="img/loading1.gif" alt="">
                </span>
              </div>
            </div>
            <span class="time"><em>00:00</em> / 00:00</span>
          </div>
        </div>
      </div>
      <div class="control3">
        <span class="" title="收藏"></span>
        <span class="" title="分享"></span>
      </div>
      <div class="control4">
        <div title="音量" class="vol">
          <div class="bg">
            <div>
              <span class="circle"></span>
            </div>
          </div>
        </div>
        <span title="循环" class="loop"></span>
        <span class="add_box">
          <span class="tip">已添加到播放列表</span>
          <span title="播放列表" class="add">0</span>
        </span>
      </div>
    </div>
    <div class="lock">
      <a href="javascript:;"></a>
    </div>
    <div class="list">
      <div class="head">
        <span class="play_list">播放列表(0)</span>
        <a href="#" class="keep_all">
          <i></i>
          收藏全部
        </a>
        <span class="line"></span>
        <a href="#" class="clear_all">
          <i></i>
          清除
        </a>
        <span class="song_name"><!-- Rolling star --></span>
        <span class="close"></span>
      </div>
      <div class="body" id="song_body">
        <!-- <img class="song_cover" src="img/rollingstart-big-cover.jpg"> -->
        <div class="song_list" id="song_list">
          <!-- <ul class="song_ul" id="song_ul">
            <li class="song_li active">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>
            <li class="song_li">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>
            <li class="song_li">
                <div class="playing"></div>
                <div class="song_name">Rolling star</div>
                <div class="icons">
                  <div>
                    <i class="delete"></i>
                    <i class="download"></i>
                    <i class="share"></i>
                    <i class="keep"></i>
                  </div>
                </div>
                <div class="song_art"><a href="#">YUI</a></div>
                <div class="song_time">00:00</div>
                <div class="song_src">
                  <a href="#">来源</a>
                </div>
            </li>
            <li class="song_li">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>
            <li class="song_li">
                <div class="playing"></div>
                <div class="song_name">Rolling star</div>
                <div class="icons">
                  <div>
                    <i class="delete"></i>
                    <i class="download"></i>
                    <i class="share"></i>
                    <i class="keep"></i>
                  </div>
                </div>
                <div class="song_art"><a href="#">YUI</a></div>
                <div class="song_time">00:00</div>
                <div class="song_src">
                  <a href="#">来源</a>
                </div>
            </li>
            <li class="song_li">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>
            <li class="song_li">
                <div class="playing"></div>
                <div class="song_name">Rolling star</div>
                <div class="icons">
                  <div>
                    <i class="delete"></i>
                    <i class="download"></i>
                    <i class="share"></i>
                    <i class="keep"></i>
                  </div>
                </div>
                <div class="song_art"><a href="#">YUI</a></div>
                <div class="song_time">00:00</div>
                <div class="song_src">
                  <a href="#">来源</a>
                </div>
            </li>
            <li class="song_li">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>
            <li class="song_li">
                <div class="playing"></div>
                <div class="song_name">Rolling star</div>
                <div class="icons">
                  <div>
                    <i class="delete"></i>
                    <i class="download"></i>
                    <i class="share"></i>
                    <i class="keep"></i>
                  </div>
                </div>
                <div class="song_art"><a href="#">YUI</a></div>
                <div class="song_time">00:00</div>
                <div class="song_src">
                  <a href="#">来源</a>
                </div>
            </li>
            <li class="song_li">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>
            <li class="song_li">
                <div class="playing"></div>
                <div class="song_name">Rolling star</div>
                <div class="icons">
                  <div>
                    <i class="delete"></i>
                    <i class="download"></i>
                    <i class="share"></i>
                    <i class="keep"></i>
                  </div>
                </div>
                <div class="song_art"><a href="#">YUI</a></div>
                <div class="song_time">00:00</div>
                <div class="song_src">
                  <a href="#">来源</a>
                </div>
            </li>
            <li class="song_li">
              <div class="playing"></div>
              <div class="song_name">Rolling star</div>
              <div class="icons">
                <div>
                  <i class="delete"></i>
                  <i class="download"></i>
                  <i class="share"></i>
                  <i class="keep"></i>
                </div>
              </div>
              <div class="song_art"><a href="#">YUI</a></div>
              <div class="song_time">00:00</div>
              <div class="song_src">
                <a href="#">来源</a>
              </div>
            </li>  
          </ul> -->
          <div class="empty">
            <p><i></i>你还没有添加任何歌曲</p><br>
            <p>去首页<a href="#">发现音乐</a>，或在<a href="#">我的音乐</a>收听自己收藏的歌单。</p>
          </div>
        </div>
        <div class="bline" id="bline">
          <div id="bar1"></div>
        </div>
        <div class="lyric_box" id="lyric_box">
          <div class="lyric" id="song_lyric">
              <div class='pBox' id='pBox'>
            <!-- <p>*该歌词不支持自动滚动* <a class="" data-id="">求滚动歌词</a></p>
            <p class="j-flag" data-time="-1">作曲 : 李奕瀚</p>
            <p class="j-flag" data-time="-1">作词 : 李奕瀚</p>
            <p class="j-flag" data-time="-1">有一紙豬會上樹  這衹豬真的上了樹有一紙豬會上樹  這衹豬真的上了樹</p>
            <p class="j-flag" data-time="-1">有一紙豬會上樹  這衹豬真的上了樹</p>
            <p class="j-flag" data-time="-1">豬它拿著氣球說要爬上這棵樹</p>
            <p class="j-flag" data-time="-1">做其他豬做不到的事</p>
            <p class="j-flag" data-time="-1">人們都笑它說它傻呼呼</p>
            <p class="j-flag" data-time="-1">哪來的豬真的會上樹</p>
            <p class="j-flag" data-time="-1">一個春夏秋冬  又是春夏秋冬</p>
            <p class="j-flag" data-time="-1">路過有彩虹的雨後晴天</p>
            <p class="j-flag" data-time="-1">在理想的路上摔倒又爬起</p>
            <p class="j-flag" data-time="-1">滿臉都沾滿時間的塵埃</p>
            <p class="j-flag" data-time="-1">它自信地爬  努力地爬  純粹地爬  奮不顧身地爬</p>
            <p class="j-flag" data-time="-1">終於上了樹  生活在高處</p>
            <p class="j-flag" data-time="-1">系在樹枝上的氣球  幸福地飄著</p> -->
            </div>
          </div>
        </div>
        <div class="bline bline-2" id="bline2">
          <div id="bar2"></div>
        </div>

      </div>
    </div>
  </div>
  <footer>
    <div>
      <div class="f-lf">
        <ul>
          <li><a href="">关于网易</a></li>
          <li><a href="">客户服务</a></li>
          <li><a href="">服务条款</a></li>
          <li><a href="">网站导航</a></li>
          <li><a href="">意见反馈</a></li>
        </ul>
        <p>
          <span>网易公司版权所有©1997-2019</span>
          <span>杭州乐读科技有限公司运营：<a href="#">浙网文[2018]3506-263号</a></span>
        </p>
        <p>
          <span>违法和不良信息举报电话：0571-89853516</span> 
          <span>举报邮箱：<a href="#">ncm5990@163.com</a></span>
        </p>
      </div>
      <div class="f-rt">
        <ul>
          <li class="auth"><a href="#"></a><i></i></li>
          <li class="musician"><a href="#"></a><i></i></li>
          <li class="reward"><a href="#"></a><i></i></li>
          <li class="cash"><a href="#"></a><i></i></li>
        </ul>
      </div>
    </div>
  </footer>

  
  <script src="js/index.js"></script>
  <script>
  (function(){
    //歌曲对象
    class song{
      constructor(sid,sname,sart,stime,ssrc,smv,slyric,s_sm_cover,s_bg_cover){
        this.sid=sid;
        this.sname=sname;
        this.sart=sart;
        this.stime=stime;
        this.ssrc=ssrc;
        this.smv=smv;
        this.slyric=slyric;
        this.s_sm_cover=s_sm_cover;
        this.s_bg_cover=s_bg_cover;
      }
    }
    //从服务器请求要播放的歌曲数组
    var songs=[
      new song(1,"Rolling star","YUI","03:10","javascript:;","javascript:;","lrc/Rolling star.lrc","img/sm_cover_rolling.jpg","img/bg_coverrolling.jpg"),
      new song(2,"东西（Cover：林俊呈）","你的叽叽","02:43","javascript:;","javascript:;","lrc/东西（Cover：林俊呈） - 你的叽叽.lrc","img/sm_cover_dx.jpg","img/bg_coverdx.jpg"),
      new song(3,"直觉","李学仕","02:40","javascript:;","javascript:;","lrc/李学仕 - 直觉.lrc","img/sm_cover_zj.jpg","img/bg_coverzj.jpg"),
      new song(4,"그 남자의 거짓말（那个男人的谎言）","泰仁","03:22","javascript:;","javascript:;","lrc/그 남자의 거짓말 - 泰仁.lrc","img/sm_cover_hy.jpg","img/bg_coverhy.jpg"),
      new song(1,"Rolling star","YUI","03:10","javascript:;","javascript:;","lrc/Rolling star.lrc","img/sm_cover_rolling.jpg","img/bg_coverrolling.jpg"),
      new song(2,"东西（Cover：林俊呈）","你的叽叽","02:43","javascript:;","javascript:;","lrc/东西（Cover：林俊呈） - 你的叽叽.lrc","img/sm_cover_dx.jpg","img/bg_coverdx.jpg"),
      new song(3,"直觉","李学仕","02:40","javascript:;","javascript:;","lrc/李学仕 - 直觉.lrc","img/sm_cover_zj.jpg","img/bg_coverzj.jpg"),
      new song(4,"그 남자의 거짓말（那个男人的谎言）","泰仁","03:22","javascript:;","javascript:;","lrc/그 남자의 거짓말 - 泰仁.lrc","img/sm_cover_hy.jpg","img/bg_coverhy.jpg"),
      new song(1,"Rolling star","YUI","03:10","javascript:;","javascript:;","lrc/Rolling star.lrc","img/sm_cover_rolling.jpg","img/bg_coverrolling.jpg"),
      new song(2,"东西（Cover：林俊呈）","你的叽叽","02:43","javascript:;","javascript:;","lrc/东西（Cover：林俊呈） - 你的叽叽.lrc","img/sm_cover_dx.jpg","img/bg_coverdx.jpg"),
      new song(3,"直觉","李学仕","02:40","javascript:;","javascript:;","lrc/李学仕 - 直觉.lrc","img/sm_cover_zj.jpg","img/bg_coverzj.jpg"),
      new song(4,"그 남자의 거짓말（那个男人的谎言）","泰仁","03:22","javascript:;","javascript:;","lrc/그 남자의 거짓말 - 泰仁.lrc","img/sm_cover_hy.jpg","img/bg_coverhy.jpg"),
      new song(1,"Rolling star","YUI","03:10","javascript:;","javascript:;","lrc/Rolling star.lrc","img/sm_cover_rolling.jpg","img/bg_coverrolling.jpg"),
      new song(2,"东西（Cover：林俊呈）","你的叽叽","02:43","javascript:;","javascript:;","lrc/东西（Cover：林俊呈） - 你的叽叽.lrc","img/sm_cover_dx.jpg","img/bg_coverdx.jpg"),
      new song(3,"直觉","李学仕","02:40","javascript:;","javascript:;","lrc/李学仕 - 直觉.lrc","img/sm_cover_zj.jpg","img/bg_coverzj.jpg"),
      new song(4,"그 남자의 거짓말（那个男人的谎言）","泰仁","03:22","javascript:;","javascript:;","lrc/그 남자의 거짓말 - 泰仁.lrc","img/sm_cover_hy.jpg","img/bg_coverhy.jpg"),
      new song(1,"Rolling star","YUI","03:10","javascript:;","javascript:;","lrc/Rolling star.lrc","img/sm_cover_rolling.jpg","img/bg_coverrolling.jpg"),
      new song(2,"东西（Cover：林俊呈）","你的叽叽","02:43","javascript:;","javascript:;","lrc/东西（Cover：林俊呈） - 你的叽叽.lrc","img/sm_cover_dx.jpg","img/bg_coverdx.jpg"),
      new song(3,"直觉","李学仕","02:40","javascript:;","javascript:;","lrc/李学仕 - 直觉.lrc","img/sm_cover_zj.jpg","img/bg_coverzj.jpg"),
      new song(4,"그 남자의 거짓말（那个男人的谎言）","泰仁","03:22","javascript:;","javascript:;","lrc/그 남자의 거짓말 - 泰仁.lrc","img/sm_cover_hy.jpg","img/bg_coverhy.jpg"),
      new song(1,"Rolling star","YUI","03:10","javascript:;","javascript:;","lrc/Rolling star.lrc","img/sm_cover_rolling.jpg","img/bg_coverrolling.jpg"),
      new song(2,"东西（Cover：林俊呈）","你的叽叽","02:43","javascript:;","javascript:;","lrc/东西（Cover：林俊呈） - 你的叽叽.lrc","img/sm_cover_dx.jpg","img/bg_coverdx.jpg"),
      new song(3,"直觉","李学仕","02:40","javascript:;","javascript:;","lrc/李学仕 - 直觉.lrc","img/sm_cover_zj.jpg","img/bg_coverzj.jpg"),
      new song(4,"그 남자의 거짓말（那个男人的谎言）","泰仁","03:22","javascript:;","javascript:;","lrc/그 남자의 거짓말 - 泰仁.lrc","img/sm_cover_hy.jpg","img/bg_coverhy.jpg"),
      
    ];
    
    /*************************************将歌曲列表插入页面*/
    var song_list=document.getElementById("song_list");
    var html="<ul class='song_ul' id='song_ul'>";
    for(var s of songs){
      html+=`<li class="song_li">
                <div class="playing"></div>
                <div class="song_name">${s.sname}</div>
                <div class="icons">
                  <div>
                    <i class="delete"></i>
                    <i class="download"></i>
                    <i class="share"></i>
                    <i class="keep"></i>
                  </div>
                </div>
                <div class="song_art"><a href="#">${s.sart}</a></div>
                <div class="song_time">${s.stime}</div>
                <div class="song_src">
                  <a href="${s.ssrc}">来源</a>
                </div>
              </li>`;
    }
    html+="</ul>";
    song_list.innerHTML=html;

    var song_info=document.getElementById("song_info");
    var song_list=document.getElementById("song_list");
    var song_ul=document.getElementById("song_ul");
    var song_li=song_ul.querySelector(".song_li");
    var ulH=song_ul.offsetHeight;
    var listH=song_list.offsetHeight;
    var liH=song_li.offsetHeight;
    var song_ls=song_ul.getElementsByTagName("LI");
    var song_body=document.getElementById("song_body");
    var sm_cover=document.getElementById("sm_cover");
    var lyric_box=document.getElementById("lyric_box");
    var song_lyric=document.getElementById("song_lyric");
    var lyr_boxH=lyric_box.offsetHeight;
    var lyricH=song_lyric.offsetHeight;
    var pbox=document.getElementById("pBox");;
    var ps=[];
    var maxPh=0;
    var pBoxH=0;
    var bline=document.getElementById("bline");
    var bar1=bline.querySelector("div");
    var bline2=document.getElementById("bline2");
    var bar2=bline2.querySelector("div");
    var _this=null;
    var times=[];
    var wheelDis=0;
    var barDis=0;
    var lyricWheelDis=0;
    var lyricBarDis=0;
    
    bar1.style.height=blineH(listH,ulH)+"px";
    //获取bar1的高度
    var bar1H=blineH(listH,ulH);
    if(ulH>listH)//如果歌曲列表的总高度大于盒子的高度，则显示滚动条
      bline.className="bline active";
    
    /********************************点击歌曲列表中的一条歌曲，在播放器中插入歌曲信息，添加样式，插入歌词，播放音乐*/
    song_ul.onclick=function(event){
      var e=event || window.event;
      var nName=e.target.nodeName;
      if(nName==="A"){
        return
      }else if(nName==="I"){

      }else{
        //取消上一轮的active样式
        if(_this)_this.className="song_li";
        init();
        _this=e.target
        while(_this.nodeName!=='LI'){
          _this=_this.parentNode;
        }

        //本轮添加active样式
        _this.className="song_li active";
        var i=[].indexOf.call(song_ls,_this);
        inner(i);
        innerLyric(i)
      }
    }

    //插入封面，作者，等信息
    function inner(i){
      html=`<a href="#" class="song">${songs[i].sname}</a>`
      html+=songs[i].smv!=="javascript:;"?`<a href="${songs[i].smv}" class="mv"></a>`:'';
      html+=`<a href="#" class="artist" id="artist">${songs[i].sart}</a>`;
      html+=songs[i].ssrc!=="javascript:;"?`<a href="${songs[i].ssrc}" class="src" title="来自榜单"></a>`:''
      //插入info
      song_info.innerHTML=html;
      //插入大封面
      var img= new Image();
      img.src=songs[i].s_bg_cover;
      img.className="song_cover";
      img.id="bg_cover"
      song_body.insertBefore(img,song_list)
      //插入小封面
      html=`<img src="${songs[i].s_sm_cover}" alt="">
            <a href="#" ></a>`;
      sm_cover.innerHTML=html;

    }
    //插入歌词
    function innerLyric(i){
      var xhr=new XMLHttpRequest();
      xhr.onreadystatechange=function(){
        if(xhr.readyState==4&&xhr.status==200){
          html="";
          times.splice(0);
          //从服务器请求歌词，并按换行符分割成数组
          var ps=xhr.responseText.split('\n');
          //问题：有写歌词是双语，多语版本的，按换行符分割会被划分到不同的行
          //解决：循环ps如果ps[i]和ps[i+1]时间相同则i和i+i行的歌词放到同一个p里面，中间添加br换行
          for(var i=0,_i=0;i<ps.length-1;i++){
            //[00:25.210] [00:17] [00:51.59]
            var curTime=ps[i].match(/\[\d{2}\:\d{2}\.?\d{0,3}\]/);
            var nextTime=ps[i+1].match(/\[\d{2}\:\d{2}\.?\d{0,3}\]/);
            //00:25.210
            curTime=curTime&&curTime[0].replace(/[\[\]]/g,'');
            nextTime=nextTime&&nextTime[0].replace(/[\[\]]/g,'');
           
            //将时间转换成毫秒
            curTime=curTime&&curTime.split(/[\.:]/g);
            nextTime=nextTime&&nextTime.split(/[\.:]/g);
            curTime=curTime&&(parseInt(curTime[0])*60*1000+parseInt(curTime[1])*1000+parseInt(curTime[2]||0));
            nextTime=nextTime&&(parseInt(nextTime[0])*60*1000+parseInt(nextTime[1])*1000+parseInt(nextTime[2]||0));
            
            //获取歌词
            var curLrc=ps[i].replace(/\[\d{2}\:\d{2}\.?\d{0,3}\]/,'');
            var nextLrc=ps[i+1].replace(/\[\d{2}\:\d{2}\.?\d{0,3}\]/,'');
            html+=`<p>${curLrc}`;
            //当前时间插入数组，获得时间数组，强调if里面的i和for的i是同一个i,所以具备去重复的能力
            times.push(curTime||0);
            //如果相同，添加一个br,把nextLrc插入同一个p
            if(curTime==nextTime){
              i++;
              html+=`<br>${nextLrc}`
            }else{
              html+='</p>'
            } 
          } 
          //插入歌词
          pbox.innerHTML=html;
          
          //设置滚动条高度
          pBoxH=pbox.offsetHeight;
          bar2.style.height=blineH(lyricH,pBoxH)+"px";
          if(lyricH<pBoxH)//如果歌词高度大于盒子高度，显示滚动条
            bline2.className="bline bline-2 active";
          //获取最高的p的高度，作为每次滚动的距离
          ps=pbox.querySelectorAll("p");
          var psH=[];
          for(var p of ps){
            psH.push(p.offsetHeight);
          }
          maxPh=Math.max(...psH);
        }
      }
      xhr.open("get",`${songs[i].slyric}`,true);
      xhr.send(null);
    }
    //计算滚动条高度
    function blineH(h_box,h_doc){
      if (h_doc>h_box)
        return h_box*h_box/h_doc;
    }
   

    /*************************************给歌曲列表添加滚动事件*/
    var isMacWebkit = (navigator.userAgent.indexOf("Macintosh")!==-1&&
                      navigator.userAgent.indexOf("WebKit") !== -1);
    var isFirefox=(navigator.userAgent.indexOf("Gecko")!==-1);
    song_list.onwheel=fnsong_listWheel;//未来浏览器
    song_list.onwheel=fnsong_listWheel;//大多数当前浏览器
    if(isFirefox)//仅火狐
      song_list.addEventListener('DOMMouseScroll',fnsong_listWheel,false);
    //事件处理函数
    function fnsong_listWheel(event){
      var e= event || window.event;//标准 || IE
      var deltaY=e.deltaY*-30||e.wheelDelta/4||e.detail*-10;
      if(isMacWebkit)
        deltaY/=30;
      if(isFirefox && e.type!=="DOMMouseScroll")
        song_list.removeEventListener('DOMMouseScroll',fnsong_listWheel,false);
      

      if(deltaY<=-30){//向下滚
        wheelDis-=liH;//计算移动的激励
        barDis=-wheelDis*listH/ulH; //计算滚动条移动的距离 
        if(Math.abs(wheelDis)>=ulH-listH){
          wheelDis=-(ulH-listH)
          barDis=listH-bar1.offsetHeight;
        }
      }else{//向上滚动
        wheelDis+=liH;
        barDis=-wheelDis*listH/ulH; 
        if(wheelDis>=0){
          wheelDis=0;
          barDis=0;
        } 
      }
      song_ul.style.top=wheelDis+'px';
      bar1.style.top=barDis+'px';


      
      if(e.preventDefault) e.preventDefault();//阻止默认
      if(e.stopPropagation) e.stopPropagation();//阻止冒泡
      e.cancelBubble=true;//IE 阻止冒泡
      e.returnValue=false;//IE
      return false;
    }
    


    /*************************************给歌词添加滚动事件*/
    lyric_box.onwheel=fnlyric_wheel;//未来浏览器
    lyric_box.onwheel=fnlyric_wheel;//大多数当前浏览器
    if(isFirefox)//仅火狐
      lyric_box.addEventListener('DOMMouseScroll',fnlyric_wheel,false);
    //事件处理函数
    function fnlyric_wheel(event){
      var e= event || window.event;//标准 || IE
      var deltaY=e.deltaY*-30||e.wheelDelta/4||e.detail*-10;
      if(isMacWebkit)
        deltaY/=30;
      if(isFirefox && e.type!=="DOMMouseScroll")
        lyric_box.removeEventListener('DOMMouseScroll',fnlyric_wheel,false);


      if(deltaY<=-30){//向下滚
        lyricWheelDis-=maxPh;//计算歌词滚动距离
        lyricBarDis=-lyricWheelDis*listH/pBoxH;//计算滚动条滚动距离
        if(Math.abs(lyricWheelDis)>=pBoxH-lyricH){
          lyricWheelDis=-(pBoxH-lyricH);
          lyricBarDis=listH-bar2.offsetHeight;
        }
      }else{
        lyricWheelDis+=maxPh;
        lyricBarDis=-lyricWheelDis*listH/pBoxH;
        if(lyricWheelDis>=0){
          lyricWheelDis=0;
          lyricBarDis=0;
        }
      }
      //计算完毕执行滚动
      pbox.style.top=lyricWheelDis+"px";
      bar2.style.top=lyricBarDis+"px";

      if(e.preventDefault) e.preventDefault();//阻止默认
      if(e.stopPropagation) e.stopPropagation();//阻止冒泡
      e.cancelBubble=true;//IE 阻止冒泡
      e.returnValue=false;//IE
      return false;
    }
   
    /************************************每次点击一条歌曲都要重置歌词和歌词滚动体的位置到顶部*/
    function init(){
      lyricWheelDis=0;
      lyricBarDis=0;
      pbox.style.top=lyricWheelDis+"px";
      bar2.style.top=lyricBarDis+"px";
    }


    /*************************************歌曲列表的滚动条的bline添加mousedown事件，一旦mousedown滚动条和歌曲列表滚动到相应位置*/
    //问题：一开始使用onclik,但是bar1的mousedown 和 mouseup老是会触发一次click
    //阻止默认行为，阻止冒泡，取消click事件都没有用。解决：改成mousedown事件
    //问题:这样改后会同时触发bline的mousedown和bar1的mousedown,先触发子再触发父
    //解决：阻止bar1冒泡，但是该功能不想这样，解决2：将curPy=parseFloat(bar1.style.top)||0;放到
    //bind1的mousedown上，计算的值就是对的，不要放到bar1的mousedown上
    bline.onmousedown=mousdown;
    function mousdown(event){
      var e= event || window.event;
      var _this=e.target;
      //因为bar的位置老是变得，获得的相对于视口的位置值老是变动，导致滚动出错，所以bar上点击直接返回不执行
      while(_this.id!=="bline") {
        _this=_this.parentNode;
      };
      //点击事件相对于bline左上角的坐标
      var offsetY=e.clientY-_this.getBoundingClientRect().top;
      // var bar1H=bar1.offsetHeight;
      //计算bar的移动距离
      barDis=offsetY-bar1H/2;
      mv(barDis);

      //获取当前bar1的位置
      curPy=parseFloat(bar1.style.top)||0;
    }

    /* *******************************给bar1添加mousemove事件，改事件有mousedown添加，mouseup取消 */
    //鼠标压下去的位置
    var downY=0;
    var curPy=0;//当前的位置
    bar1.onmousedown=function(event){
      var e= event || window.event;
      downY=e.clientY;
      document.onmousemove=barMv;
      // e.stopPropagation()
    }
    function barMv(event){
      var e= event || window.event;
      //当前的位置加上移动的距离
      barDis=curPy+e.clientY-downY;
      mv(barDis)
    }
    //移动列表和滚动条
    function mv(barDis){
      //移动距离超过底部，则等于底部
      bar1H=bar1.offsetHeight;
      if(barDis+bar1H>=listH)
        barDis=listH-bar1H;
      //移动距离超过顶部则等于0
      if(barDis<=0)
        barDis=0;
      //通过bar的移动距离计算歌曲列表的移动距离
      wheelDis=-barDis*ulH/listH;
      
      bar1.style.top=barDis+"px";
      song_ul.style.top=wheelDis+'px';
    }
    document.onmouseup=function(event){
      var e= event || window.event;
      document.onmousemove=null;
    }
    //mousemv老是触发html5推拽默认行为，阻止它
    //阻止html5拖拽默认行为（显示禁手）
    bar1.ondragstart=function(event){
      var e= event || window.event;
      e.preventDefault();
      // e.stopPropagation();
    }
  })();

  /* *******************************给歌词的bline2添加mousedown事件，一旦点击歌词和滚动条滚动到响应位置 */
  bline2.onmousedown=function(event){
    var e= event || window.event;

    
  }
  </script>
</body>
</html>